#!/usr/bin/env bash
set -euo pipefail

# Get to the esphome directory (parent of scripts)
cd "$(dirname "$0")/.." || exit 1

if ! command -v op >/dev/null 2>&1; then
  echo "1Password CLI 'op' not found in PATH" >&2
  exit 1
fi

if [ ! -f secrets.tmpl ]; then
  echo "secrets.tmpl not found in $(pwd)" >&2
  exit 1
fi

op inject -i secrets.tmpl -o secrets.yaml
echo "Rendered esphome/secrets.yaml from secrets.tmpl"
